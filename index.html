<!doctype html>
<html lang="id">
<head>
  <meta chars      <article class="max-w-4xl mx-auto px-4 py-6 prose prose-invert max-w-none leading-relaxed">"utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Docs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    .prose pre{overflow:auto;border-radius:.5rem;padding:1rem;background:#1e293b;border:1px solid #334155}
    .prose code{font-family:ui-monospace,Menlo,Consolas,monospace;background:#1e293b;padding:0.125rem 0.25rem;border-radius:0.25rem;font-size:0.875em}
    .prose pre code{background:none;padding:0;border:none}
    .prose h1,.prose h2,.prose h3,.prose h4,.prose h5,.prose h6{margin-top:1.5em;margin-bottom:0.5em;color:#f1f5f9;border-bottom:1px solid #334155;padding-bottom:0.25em}
    .prose h1{font-size:2em}
    .prose h2{font-size:1.5em}
    .prose h3{font-size:1.25em}
    .prose p{margin-bottom:1em;color:#cbd5e1;line-height:1.6}
    .prose ul,.prose ol{margin-bottom:1em;padding-left:1.5em}
    .prose li{margin-bottom:0.25em}
    .prose blockquote{border-left:4px solid #475569;padding-left:1em;margin:1em 0;color:#94a3b8;font-style:italic;background:#0f172a;padding:1em;border-radius:0.5rem}
    .prose table{border-collapse:collapse;width:100%;margin:1em 0;border:1px solid #334155}
    .prose th,.prose td{border:1px solid #334155;padding:0.5em;text-align:left}
    .prose th{background:#1e293b;font-weight:600}
    .prose a{color:#60a5fa;text-decoration:underline}
    .prose a:hover{color:#93c5fd}
    .prose hr{border:0;border-top:1px solid #334155;margin:2em 0}
    .prose strong{font-weight:600;color:#f1f5f9}
    .prose em{font-style:italic;color:#cbd5e1}
    html{scroll-behavior:smooth}
    .transition-all{transition:all 0.2s ease}
    .rotate-90{transform:rotate(90deg)}
    .active{background:rgba(99,102,241,.15)}
    #content{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}
    #content *{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}
  </style>
</head>
<body class="bg-slate-950 text-slate-200">
  <div class="flex h-screen">
    <aside class="w-72 shrink-0 border-r border-white/10 bg-slate-900/60 backdrop-blur">
      <div class="p-4 border-b border-white/10">
        <div class="text-xl font-bold">📚 Docs</div>
        <div id="meta" class="text-xs text-slate-400 mt-1"></div>
        <input id="search" placeholder="Cari…" class="mt-3 w-full rounded bg-slate-800/70 border border-white/10 px-3 py-2 text-sm outline-none">
        <button id="themeToggle" class="mt-2 w-full bg-slate-700 text-slate-200 px-3 py-2 rounded text-sm hover:bg-slate-600 transition-colors">🌙 Dark Mode</button>
      </div>
      <nav id="list" class="p-2 overflow-y-auto h-[calc(100vh-5.5rem)]"></nav>
    </aside>
    <main class="flex-1 overflow-y-auto">
      <header class="sticky top-0 z-10 border-b border-white/10 bg-slate-900/70 backdrop-blur">
        <div class="max-w-4xl mx-auto px-4 py-3 text-sm text-slate-400" id="crumb"></div>
      </header>
      <article class="max-w-4xl mx-auto px-4 py-6">
        <div id="content" class="prose prose-invert max-w-none">Memuat…</div>
      </article>
    </main>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    let MANIFEST = null;
    let FILTERED = [];

    function titleFromPath(p){
      const name = p.split('/').pop();
      return name.replace(/\.md$/i,'').replace(/[-_]/g,' ').replace(/\b\w/g,c=>c.toUpperCase());
    }

    function groupByDir(files){
      const tree = {};
      files.forEach(p=>{
        const segs = p.split('/');
        const dir = segs.length>1 ? segs.slice(0,-1).join('/') : '';
        (tree[dir] ||= []).push(p);
      });
      return tree;
    }

    function renderList(files){
      const list = $('#list');
      list.innerHTML = '';
      const tree = groupByDir(files);

      Object.keys(tree).sort().forEach(dir=>{
        if(dir === '') return; // skip root
        const wrapper = document.createElement('div');
        wrapper.className = 'mb-2';
        const header = document.createElement('div');
        header.className = 'flex items-center px-2 py-1 text-xs uppercase tracking-wide text-slate-400 hover:text-slate-300 cursor-pointer transition-colors';
        const icon = document.createElement('span');
        icon.className = 'mr-1 transition-transform';
        icon.textContent = '📁';
        header.appendChild(icon);
        header.appendChild(document.createTextNode(dir));
        const contentDiv = document.createElement('div');
        contentDiv.className = 'ml-4 mt-1 space-y-1 hidden';
        header.onclick = ()=>{
          contentDiv.classList.toggle('hidden');
          icon.classList.toggle('rotate-90');
        };
        wrapper.appendChild(header);

        tree[dir].sort().forEach(p=>{
          const a = document.createElement('a');
          a.href = '#'+encodeURIComponent(p);
          a.textContent = '📄 ' + titleFromPath(p);
          a.className = 'block px-3 py-1.5 rounded text-sm text-slate-300 hover:text-white hover:bg-slate-700 transition-colors';
          a.dataset.path = p;
          contentDiv.appendChild(a);
        });
        wrapper.appendChild(contentDiv);
        list.appendChild(wrapper);
      });

      // root files
      if(tree['']){
        tree[''].sort().forEach(p=>{
          const a = document.createElement('a');
          a.href = '#'+encodeURIComponent(p);
          a.textContent = '📄 ' + titleFromPath(p);
          a.className = 'block px-3 py-1.5 rounded text-sm text-slate-300 hover:text-white hover:bg-slate-700 transition-colors';
          a.dataset.path = p;
          list.appendChild(a);
        });
      }
      highlightActive();
    }

    function highlightActive(){
      const hash = decodeURIComponent(location.hash.replace(/^#/,''));
      $('#list').querySelectorAll('a').forEach(a=>{
        a.classList.toggle('active', a.dataset.path===hash);
      });
    }

    async function loadMD(p){
      $('#crumb').textContent = p;
      $('#content').innerHTML = '<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div></div>';
      try{
        const res = await fetch(p, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const md = await res.text();
        const html = marked.parse(md, {mangle:false, headerIds:true, breaks:true, gfm:true});
        $('#content').innerHTML = html;
        $('#content').querySelectorAll('pre code').forEach(b=>hljs.highlightElement(b));

        // Add TOC
        const headings = $('#content').querySelectorAll('h1,h2,h3,h4,h5,h6');
        if(headings.length > 0){
          const toc = document.createElement('div');
          toc.className = 'fixed top-20 right-4 w-64 bg-slate-800 p-4 rounded-lg shadow-lg max-h-96 overflow-y-auto hidden lg:block';
          toc.innerHTML = '<h4 class="text-sm font-semibold mb-2 text-slate-200">Table of Contents</h4><ul class="space-y-1 text-xs"></ul>';
          const ul = toc.querySelector('ul');
          headings.forEach(h=>{
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#'+h.id;
            a.textContent = h.textContent;
            a.className = 'block py-1 px-2 rounded hover:bg-slate-700 text-slate-300 hover:text-white transition-colors';
            a.style.paddingLeft = (parseInt(h.tagName[1])-1)*10 + 'px';
            li.appendChild(a);
            ul.appendChild(li);
          });
          document.body.appendChild(toc);
          // Toggle TOC button for mobile
          const tocBtn = document.createElement('button');
          tocBtn.textContent = '📖 TOC';
          tocBtn.className = 'fixed bottom-4 right-4 bg-indigo-600 text-white px-3 py-2 rounded-full shadow-lg hover:bg-indigo-700 transition-colors lg:hidden';
          tocBtn.onclick = ()=>toc.classList.toggle('hidden');
          document.body.appendChild(tocBtn);
        }

        // Back to top button
        const backToTop = document.createElement('button');
        backToTop.textContent = '⬆️ Top';
        backToTop.className = 'fixed bottom-4 left-4 bg-indigo-600 text-white px-3 py-2 rounded-full shadow-lg hover:bg-indigo-700 transition-colors opacity-0 pointer-events-none';
        backToTop.id = 'backToTop';
        document.body.appendChild(backToTop);
        window.addEventListener('scroll', ()=>{
          backToTop.classList.toggle('opacity-100', window.scrollY > 300);
          backToTop.classList.toggle('pointer-events-auto', window.scrollY > 300);
        });
        backToTop.onclick = ()=>window.scrollTo({top:0, behavior:'smooth'});

        $('#content').querySelectorAll('pre').forEach(pre=>{
          const code = pre.querySelector('code');
          if(code){
            const btn = document.createElement('button');
            btn.textContent = '📋 Copy';
            btn.className = 'absolute top-2 right-2 bg-slate-700 text-slate-200 px-2 py-1 rounded text-xs hover:bg-slate-600 transition-all opacity-75 hover:opacity-100';
            btn.onclick = async ()=>{
              try{
                await navigator.clipboard.writeText(code.textContent);
                btn.textContent = '✅ Copied';
                setTimeout(()=>btn.textContent='📋 Copy',2000);
              }catch(e){
                alert('Failed to copy');
              }
            };
            pre.style.position = 'relative';
            pre.appendChild(btn);
          }
        });
      }catch(e){
        $('#content').innerHTML = `<div class="text-red-400 text-center py-8">Gagal memuat <code>${p}</code>: ${e.message}</div>`;
      }
    }

    function router(){
      const hash = decodeURIComponent(location.hash.replace(/^#/,''));
      const target = hash || MANIFEST.defaultDoc || MANIFEST.files[0];
      if(target) {
        if(!hash) history.replaceState(null,'','#'+encodeURIComponent(target));
        highlightActive();
        loadMD(target);
      } else {
        $('#content').textContent = 'Tidak ada dokumen .md di repo.';
      }
    }

    async function init(){
      const res = await fetch('manifest.json', {cache:'no-store'});
      if(!res.ok){ $('#content').textContent='manifest.json tidak ditemukan.'; return; }
      MANIFEST = await res.json();
      // Normalize manifest: produce MANIFEST.files as flat array without leading slash
      function treeToFiles(tree){
        const out = [];
        (tree || []).forEach(node => {
          if(node.type === 'file'){
            const p = node.path?.startsWith('/') ? node.path.slice(1) : node.path;
            out.push(p);
          } else if(node.children){
            out.push(...treeToFiles(node.children));
          }
        });
        return out;
      }
      if(!Array.isArray(MANIFEST.files)){
        MANIFEST.files = treeToFiles(MANIFEST.tree || []);
      } else {
        // normalize existing files
        MANIFEST.files = MANIFEST.files.map(p => p?.startsWith('/') ? p.slice(1) : p);
      }
      // normalize defaultDoc as well (remove leading slash)
      if(MANIFEST.defaultDoc && MANIFEST.defaultDoc.startsWith('/')) MANIFEST.defaultDoc = MANIFEST.defaultDoc.slice(1);

      $('#meta').textContent = `Generated: ${new Date(MANIFEST.generatedAt).toLocaleString()}`;
      FILTERED = MANIFEST.files.slice();
      renderList(FILTERED);
      window.addEventListener('hashchange', router);
      router();

      $('#search').addEventListener('input', e=>{
        const q = e.target.value.trim().toLowerCase();
        FILTERED = MANIFEST.files.filter(p=>p.toLowerCase().includes(q));
        renderList(FILTERED);
      });

      // Theme toggle
      const themeToggle = $('#themeToggle');
      let isDark = true;
      themeToggle.onclick = ()=>{
        isDark = !isDark;
        document.body.className = isDark ? 'bg-slate-950 text-slate-200' : 'bg-white text-gray-900';
        themeToggle.textContent = isDark ? '🌙 Dark Mode' : '☀️ Light Mode';
        // Update colors accordingly, but for simplicity, keep dark as primary
      };
    }
    init();
  </script>
</body>
</html>
