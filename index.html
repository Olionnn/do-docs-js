<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Docs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    .prose pre{overflow:auto;border-radius:.5rem;padding:1rem}
    .prose code{font-family:ui-monospace,Menlo,Consolas,monospace}
    .active{background:rgba(99,102,241,.15)}
  </style>
</head>
<body class="bg-slate-950 text-slate-200">
  <div class="flex h-screen">
    <aside class="w-72 shrink-0 border-r border-white/10 bg-slate-900/60 backdrop-blur">
      <div class="p-4 border-b border-white/10">
        <div class="text-lg font-bold">ðŸ“š Docs</div>
        <div id="meta" class="text-xs text-slate-400 mt-1"></div>
        <input id="search" placeholder="Cariâ€¦" class="mt-3 w-full rounded bg-slate-800/70 border border-white/10 px-3 py-2 text-sm outline-none">
      </div>
      <nav id="list" class="p-2 overflow-y-auto h-[calc(100vh-5.5rem)]"></nav>
    </aside>
    <main class="flex-1 overflow-y-auto">
      <header class="sticky top-0 z-10 border-b border-white/10 bg-slate-900/70 backdrop-blur">
        <div class="max-w-4xl mx-auto px-4 py-3 text-sm text-slate-400" id="crumb"></div>
      </header>
      <article class="max-w-4xl mx-auto px-4 py-6">
        <div id="content" class="prose prose-invert max-w-none">Memuatâ€¦</div>
      </article>
    </main>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    let MANIFEST = null;
    let FILTERED = [];

    function titleFromPath(p){
      const name = p.split('/').pop();
      return name.replace(/\.md$/i,'').replace(/[-_]/g,' ').replace(/\b\w/g,c=>c.toUpperCase());
    }

    function groupByDir(files){
      const tree = {};
      files.forEach(p=>{
        const segs = p.split('/');
        const dir = segs.length>1 ? segs.slice(0,-1).join('/') : '';
        (tree[dir] ||= []).push(p);
      });
      return tree;
    }

    function renderList(files){
      const list = $('#list');
      list.innerHTML = '';
      const tree = groupByDir(files);

      Object.keys(tree).sort().forEach(dir=>{
        const wrapper = document.createElement('div');
        wrapper.className = 'mb-2';
        const header = document.createElement('div');
        header.className = 'px-2 py-1 text-xs uppercase tracking-wide text-slate-400';
        header.textContent = dir || 'root';
        wrapper.appendChild(header);

        tree[dir].sort().forEach(p=>{
          const a = document.createElement('a');
          a.href = '#'+encodeURIComponent(p);
          a.textContent = titleFromPath(p);
          a.className = 'block px-3 py-1.5 rounded text-sm text-slate-300 hover:text-white';
          a.dataset.path = p;
          wrapper.appendChild(a);
        });
        list.appendChild(wrapper);
      });
      highlightActive();
    }

    function highlightActive(){
      const hash = decodeURIComponent(location.hash.replace(/^#/,''));
      $('#list').querySelectorAll('a').forEach(a=>{
        a.classList.toggle('active', a.dataset.path===hash);
      });
    }

    async function loadMD(p){
      $('#crumb').textContent = p;
      try{
        const res = await fetch(p, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const md = await res.text();
        const html = marked.parse(md, {mangle:false, headerIds:true});
        $('#content').innerHTML = html;
        $('#content').querySelectorAll('pre code').forEach(b=>hljs.highlightElement(b));
      }catch(e){
        $('#content').innerHTML = `<div class="text-red-400">Gagal memuat <code>${p}</code>: ${e.message}</div>`;
      }
    }

    function router(){
      const hash = decodeURIComponent(location.hash.replace(/^#/,''));
      const target = hash || MANIFEST.defaultDoc || MANIFEST.files[0];
      if(target) {
        if(!hash) history.replaceState(null,'','#'+encodeURIComponent(target));
        highlightActive();
        loadMD(target);
      } else {
        $('#content').textContent = 'Tidak ada dokumen .md di repo.';
      }
    }

    async function init(){
      const res = await fetch('manifest.json', {cache:'no-store'});
      if(!res.ok){ $('#content').textContent='manifest.json tidak ditemukan.'; return; }
      MANIFEST = await res.json();
      $('#meta').textContent = `Generated: ${new Date(MANIFEST.generatedAt).toLocaleString()}`;
      FILTERED = MANIFEST.files.slice();
      renderList(FILTERED);
      window.addEventListener('hashchange', router);
      router();

      $('#search').addEventListener('input', e=>{
        const q = e.target.value.trim().toLowerCase();
        FILTERED = MANIFEST.files.filter(p=>p.toLowerCase().includes(q));
        renderList(FILTERED);
      });
    }
    init();
  </script>
</body>
</html>
